# ğŸ“Œ Importando as bibliotecas necessÃ¡rias
import pandas as pd  # ManipulaÃ§Ã£o de dados
import numpy as np  # CÃ¡lculos matemÃ¡ticos
import matplotlib.pyplot as plt  # VisualizaÃ§Ã£o de dados
import seaborn as sns  # GrÃ¡ficos avanÃ§ados
from sklearn.model_selection import train_test_split  # DivisÃ£o dos dados
from sklearn.preprocessing import StandardScaler  # NormalizaÃ§Ã£o dos dados
from sklearn.ensemble import RandomForestClassifier  # Modelo de ML
from xgboost import XGBClassifier  # Modelo XGBoost
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix  # MÃ©tricas

# ğŸ”½ Passo 1: Carregar o conjunto de dados
# O dataset contÃ©m transaÃ§Ãµes de cartÃ£o de crÃ©dito, sendo 0 = normal e 1 = fraude
df = pd.read_csv("creditcard.csv")  # Certifique-se de ter esse arquivo no diretÃ³rio

# ğŸ”½ Passo 2: Explorar os dados
print("ğŸ“Š Visualizando as primeiras linhas do dataset:")
print(df.head())  # Exibir as primeiras 5 linhas do dataset

# Verificar a quantidade de fraudes (1) e transaÃ§Ãµes normais (0)
print("\nğŸ“Š Contagem de transaÃ§Ãµes normais e fraudulentas:")
print(df["Class"].value_counts())

# ğŸ”½ Passo 3: PrÃ©-processamento dos dados
# Como a coluna "Amount" varia muito, normalizamos os valores para melhorar o desempenho do modelo
scaler = StandardScaler()
df["Amount"] = scaler.fit_transform(df["Amount"].values.reshape(-1, 1))

# Separar os dados entre Features (X) e Target (y)
X = df.drop("Class", axis=1)  # Removemos a coluna de classe, pois serÃ¡ a variÃ¡vel alvo
y = df["Class"]  # Essa Ã© a variÃ¡vel que queremos prever

# ğŸ”½ Passo 4: Dividir o dataset em treino (80%) e teste (20%)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# ğŸ”½ Passo 5: Treinamento dos Modelos de Machine Learning
# ğŸŒ³ Random Forest Classifier
rf_model = RandomForestClassifier(n_estimators=100, random_state=42)
rf_model.fit(X_train, y_train)  # Treinamento do modelo

# âš¡ XGBoost Classifier
xgb_model = XGBClassifier(n_estimators=100, learning_rate=0.1, random_state=42)
xgb_model.fit(X_train, y_train)  # Treinamento do modelo

# ğŸ”½ Passo 6: Fazer PrevisÃµes com os Modelos
y_pred_rf = rf_model.predict(X_test)  # PrevisÃµes do Random Forest
y_pred_xgb = xgb_model.predict(X_test)  # PrevisÃµes do XGBoost

# ğŸ”½ Passo 7: AvaliaÃ§Ã£o dos Modelos
print("\nğŸ“Š RelatÃ³rio de ClassificaÃ§Ã£o - Random Forest:")
print(classification_report(y_test, y_pred_rf))

print("\nğŸ“Š RelatÃ³rio de ClassificaÃ§Ã£o - XGBoost:")
print(classification_report(y_test, y_pred_xgb))

# ğŸ”½ Passo 8: Criar a Matriz de ConfusÃ£o para Visualizar o Desempenho
plt.figure(figsize=(6, 4))
sns.heatmap(confusion_matrix(y_test, y_pred_xgb), annot=True, fmt="d", cmap="Blues")
plt.xlabel("Previsto")
plt.ylabel("Real")
plt.title("Matriz de ConfusÃ£o - XGBoost")
plt.show()

# ğŸ”½ Passo 9: Criar um GrÃ¡fico para Visualizar a DistribuiÃ§Ã£o das Fraudes
plt.figure(figsize=(10, 6))
sns.boxplot(x="Class", y="Amount", data=df)
plt.title("DistribuiÃ§Ã£o de Valores de TransaÃ§Ã£o por Tipo")
plt.show()

# ğŸ”½ Passo 10: Criar um Exemplo de PrediÃ§Ã£o
# Exemplo de uma nova transaÃ§Ã£o (valores fictÃ­cios)
nova_transacao = [[5000, 0, 1, 0.8, 0, 1]]  # (valor, localizaÃ§Ã£o, frequÃªncia, etc.)
previsao = xgb_model.predict(nova_transacao)

if previsao == 1:
    print("âš ï¸ TransaÃ§Ã£o Suspeita! ğŸš¨")
else:
    print("âœ… TransaÃ§Ã£o Normal.")
